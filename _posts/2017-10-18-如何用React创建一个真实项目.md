---
title: å¦‚ä½•ç”¨Reactåˆ›å»ºä¸€ä¸ªçœŸå®é¡¹ç›®
date: 2017-10-16
description: å‡è®¾æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªåº”ç”¨ï¼Œå¦‚ä½•ç”¨reactçš„æ€ç»´è¿›è¡Œåˆ›å»ºå‘¢ï¼Ÿä¸€äº›æ‰€è°“å¯æ€•çš„ä¹¦ï¼›
categories:
 - React
 - æ¡†æ¶
photos:
 - 
tags: React æ¡†æ¶ æ¡ˆä¾‹
---
>å‡è®¾æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªåº”ç”¨ï¼Œå¦‚ä½•ç”¨reactçš„æ€ç»´è¿›è¡Œåˆ›å»ºå‘¢ï¼Ÿæœ¬ä¾‹æ˜¯reactå®˜ç½‘çš„ä¾‹å­ï¼Œä¸»è¦æ˜¯è¿›è¡Œæ›´è¯¦ç»†çš„å™è¿°å’Œç»†èŠ‚è¡¥å……ã€‚

æ³¨ï¼šæœ¬æ–‡é»˜è®¤æ‚¨å·²ç»æ¸…æ¥šreactçš„åŸºæœ¬ç”¨æ³•äº†ï¼Œä¸æ¸…æ¥šè¯·ç‚¹å‡»[Reactå®˜ç½‘](https://reactjs.org/)å­¦ä¹ å“¦ã€‚

## æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªä»€ä¹ˆæ ·çš„åº”ç”¨ï¼Ÿ

å‡è®¾æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªå•†å“åˆ—è¡¨çš„åº”ç”¨ã€‚
ç•Œé¢å¦‚ä¸‹ï¼ˆä¸€èˆ¬ç•Œé¢æˆ‘ä»¬å¯ä»¥ä»è®¾è®¡å¸ˆå¤„æ‹¿åˆ°ï¼‰
![](http://oxpvb4fav.bkt.clouddn.com/15082969712814.jpg)


è€Œæˆ‘ä»¬ä»åç«¯è·å–çš„æ•°æ®å¦‚ä¸‹:

```js
[
  {category: "Sporting Goods", price: "$49.99", stocked: true, name: "Football"},
  {category: "Sporting Goods", price: "$9.99", stocked: true, name: "Baseball"},
  {category: "Sporting Goods", price: "$29.99", stocked: false, name: "Basketball"},
  {category: "Electronics", price: "$99.99", stocked: true, name: "iPod Touch"},
  {category: "Electronics", price: "$399.99", stocked: false, name: "iPhone 5"},
  {category: "Electronics", price: "$199.99", stocked: true, name: "Nexus 7"}
];
```

## Step 1: Break The UI Into A Component Hierarchy
ï¼ˆæŠŠUIåˆ†æˆå±‚çº§ç»„ä»¶ï¼‰

é¦–å…ˆä½ å¯ä»¥æ ¹æ®UIå›¾å½¢ä¸ºæ¯ä¸ªcomponentåˆ’åˆ†åŒºåŸŸï¼ˆä¸€ä¸ªçŸ©å½¢ä¹‹ç±»ï¼‰ï¼Œå¦‚æœè®¾è®¡ç¨¿åšå¾—å¥½ï¼Œå¾ˆå¯èƒ½æ¯ä¸ªå›¾å±‚çš„åç§°å°±æ˜¯æˆ‘ä»¬çš„ç»„ä»¶åç§°ã€‚

![](http://oxpvb4fav.bkt.clouddn.com/15083115906577.png)

å¦‚ä½•è¿›è¡Œåˆ†å±‚å‘¢ï¼ŸåŸåˆ™å’Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°å’Œå¯¹è±¡æ˜¯ä¸€è‡´çš„ï¼Œå°±æ˜¯**â€œå•ä¸€èŒè´£åŸåˆ™â€**ã€‚ä¸€ä¸ªç»„ä»¶ç†è®ºä¸Šåº”è¯¥åªåšä¸€ä»¶äº‹ã€‚å¦‚æœå†…èƒ½è¿˜èƒ½åœ¨åˆ’åˆ†ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥ç»§ç»­ç»†åŒ–ã€‚

ç”±äºæ‚¨ç»å¸¸å‘ç”¨æˆ·æ˜¾ç¤ºJSONæ•°æ®æ¨¡å‹ï¼Œæ‚¨ä¼šå‘ç°ï¼Œå¦‚æœæ‚¨çš„æ¨¡å‹æ„å»ºæ­£ç¡®ï¼Œæ‚¨çš„UIï¼ˆä»¥åŠæ‚¨çš„ç»„ä»¶ç»“æ„ï¼‰å°†å¾ˆå¥½åœ°æ˜ å°„ã€‚ è¿™æ˜¯å› ä¸ºUIå’Œæ•°æ®æ¨¡å‹å€¾å‘äºéµå¾ªç›¸åŒçš„ä¿¡æ¯æ¶æ„ï¼Œè¿™æ„å‘³ç€å°†UIåˆ†æˆç»„ä»¶çš„å·¥ä½œå¾€å¾€æ˜¯å¾®ä¸è¶³é“çš„ã€‚ åªéœ€å°†å…¶åˆ†è§£æˆä»£è¡¨æ‚¨çš„æ•°æ®æ¨¡å‹çš„ä¸€éƒ¨åˆ†ã€‚

åŸºäºä»¥ä¸ŠåŸåˆ™ï¼Œæˆ‘ä»¬æŠŠåº”ç”¨åˆ†æˆä»¥ä¸‹ç»„ä»¶ã€‚

-  **FilterableProductTable (æ©˜è‰²)**: *contains the entirety of the example*
- **SearchBar (è“è‰²)**: *receives all user input*
- **ProductTable (ç»¿è‰²)**: *displays and filters the data collection based on user input*
- **ProductCategoryRow (è“ç»¿è‰²)**: *displays a heading for each category*
- **ProductRow (çº¢è‰²)**: displays a row for each product

### æ‰€ä»¥æˆ‘ä»¬çš„ç»„ä»¶å±‚çº§ç»“æœå¦‚ä¸‹

- FilterableProductTable
 - SearchBar
 - ProductTable
   - -- ProductCategoryRow
   - -- ProductRow

### æ ¹æ®æˆ‘ä»¬çš„ç»“æ„åˆ›å»ºåˆçº§ä»£ç 
**ä»£ç å¦‚ä¸‹**

```js
/**
 * Created by zhengzehao on 2017/10/18.
 */
import React, {Component} from 'react'
import  './myCss.css'
class FilterableProductTable extends Component {

    render() {
        return (<div>
            <SearchBar/>
            <ProductTable/>
        </div>)
    }
}

class SearchBar extends Component {

    render() {
        return (<h2>SearchBar</h2>)
    }
}

class ProductTable extends Component {


    render() {
        return (<div>
            <h2>
            ProductTable
            </h2>
            <div>
                <ProductCategoryRow/>
                <ProductRow/>
            </div>
        </div>)
    }
}

class ProductCategoryRow extends Component {


    render() {
        return (<div>ProductCategoryRow</div>)
    }
}

class ProductRow extends Component {


    render() {
        return (<div>ProductRow</div>)
    }
}

const PRODUCTS = [
    {category: 'Sporting Goods', price: '$49.99', stocked: true, name: 'Football'},
    {category: 'Sporting Goods', price: '$9.99', stocked: true, name: 'Baseball'},
    {category: 'Sporting Goods', price: '$29.99', stocked: false, name: 'Basketball'},
    {category: 'Electronics', price: '$99.99', stocked: true, name: 'iPod Touch'},
    {category: 'Electronics', price: '$399.99', stocked: false, name: 'iPhone 5'},
    {category: 'Electronics', price: '$199.99', stocked: true, name: 'Nexus 7'}
];
export default FilterableProductTable

```

æˆ‘ä»¬é¢„è§ˆçœ‹çœ‹ç»“æœæ€ä¹ˆæ ·ã€‚
    ![](http://oxpvb4fav.bkt.clouddn.com/15083128892540.jpg)

## Step 2: Build A Static Version in React(ç”¨åˆ›å»ºä¸€ä¸ªé™æ€ç‰ˆæœ¬)

>è™½ç„¶ä¸Šé¢çš„åŸºç¡€ç‰ˆæœ¬çœ‹èµ·æœ‰ç‚¹ä¸‘ï¼Œä½†æ˜¯ç¡®å®šäº†æˆ‘ä»¬çš„ç»„ä»¶å’Œå±‚çº§å…³ç³»ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸è€ƒè™‘å…¶äº¤äº’å…³ç³»ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªé™æ€ç‰ˆæœ¬ã€‚
å› ä¸ºåˆ›å»ºè¿™æ ·çš„ç‰ˆæœ¬å¯ä»¥å¯ä»¥æ ¹æ®å„ä¸ªæ¨¡å—åˆ†åˆ«åˆ›å»ºï¼Œè€Œä¸éœ€è¦è€ƒè™‘é‚£ä¹ˆå¤šçš„æ•°æ®ä¼ é€’æ–¹å¼ã€‚

é¦–å…ˆéœ€è¦ç¡®å®šçš„æ˜¯ï¼Œæ—¢ç„¶æ˜¯é™æ€ç‰ˆæœ¬ï¼Œæˆ‘ä»¬è¿˜ä¸éœ€è¦stateï¼Œå› ä¸ºä½¿ç”¨stateæ„å‘³ç€æˆ‘ä»¬æœ‰æ•°æ®çš„äº¤äº’ï¼Œè€Œæˆ‘ä»¬åªæ˜¯åˆ›å»ºé™æ€ç‰ˆæœ¬ã€‚
è€Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨propså‘¢ï¼Ÿå› ä¸ºpropsæ˜¯çˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶çš„æ–¹å¼ï¼Œæ—¢ç„¶æˆ‘ä»¬ç¡®å®šäº†å±‚çº§å…³ç³»ï¼Œåœ¨é™æ€ç‰ˆæœ¬æˆ‘ä»¬ä¹Ÿéœ€è¦ç¡®å®šå­ç»„ä»¶çš„æ•°æ®æ¥æºã€‚

>è‡³äºæ˜¯è‡ªä¸Šè€Œä¸‹ï¼ˆtop-downï¼‰ï¼Œè¿˜æ˜¯è‡ªä¸‹è€Œä¸Šï¼ˆbottom-upï¼‰ï¼Œå–å†³äºæˆ‘ä»¬çš„ç»“æ„ï¼Œä¸€èˆ¬å°åº”ç”¨æˆ‘ä»¬ç”¨è‡ªä¸Šè€Œä¸‹æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œè€Œå±‚çº§æ¯”è¾ƒå¤šè€Œå¤æ‚çš„ç»„ä»¶ï¼Œæˆ‘ä»¬é‡‡å–è‡ªä¸‹è€Œä¸Šæ˜¯æ¯”è¾ƒç†æƒ³çš„ã€‚

### FilterableProductTableçš„ä¿®æ”¹

å¯¹äºè¿™ä¸ªæœ€å¤§çš„ä¸Šå±‚ç»„ä»¶ï¼Œæˆ‘ä»¬ç¡®å®šçš„æ˜¯å…³ç³»å¦‚ä¸‹ï¼š

```js
<div>
    <SearchBar/>
    <ProductTable/>
</div>
```
ä½†æ—¢ç„¶æˆ‘ä»¬```<ProductTable/>```éœ€è¦å±•ç¤ºæ•°æ®ï¼Œæˆ‘ä»¬çš„æ¥æºå°±éœ€è¦ä»é¡¶å±‚è¿™é‡Œè·å–ã€‚
å› æ­¤æˆ‘ä»¬çš„ç»„ä»¶ä¿®æ”¹å¦‚ä¸‹ï¼š
(åªæ˜¯æ·»åŠ äº†productsçš„å¼•ç”¨ï¼Œç®€å•å§...)

```js
class FilterableProductTable extends Component {
    render() {
        return (<div>
            <SearchBar/>
            <ProductTable products={PRODUCTS}/>
        </div>)
    }
}
```

### SearchBarçš„ä¿®æ”¹

æƒ³æƒ³æˆ‘ä»¬çš„SearchBaré•¿ä»€ä¹ˆæ ·ï¼Ÿ
![](http://oxpvb4fav.bkt.clouddn.com/15083139967790.png)

ä¸€ä¸ªinputæ¡†å’Œä¸€ä¸ªcheckboxï¼Œç„¶åæ˜¯ä¸€æ®µæ–‡å­—

æ‰€ä»¥å¾ˆå®¹æ˜“å°±åˆ›å»ºä»¥ä¸‹ç»“æ„ã€‚
>psï¼šæˆ‘ä»¬å…ˆä¸è€ƒè™‘æ•°æ®äº¤äº’ï¼Œå…ˆåšé™æ€ç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆä¸ä¸
productsäº¤äº’ã€‚

```js
class SearchBar extends Component {
    render() {
        return (
            <div>
                <input type="text" placeholder="Search"/>
                <p>
                    <input type="checkbox"/>{''}Only show products in stock
                </p>
            </div>
        )
    }
}
```
>è¿™æ˜¯çš„pæ ‡ç­¾åªæ˜¯ç”¨ä»¥åŒºåˆ†inputå’Œcheckboxï¼Œæˆ–è€…è¯´æ¢è¡Œç”¨çš„ï¼Œå¯ä»¥è‡ªè¡Œæ›¿æ¢.

### ProductTableçš„ä¿®æ”¹
![](http://oxpvb4fav.bkt.clouddn.com/15083141936083.jpg)
åŒæ ·ï¼Œæˆ‘ä»¬æ ¹æ®UIæ¥çœ‹htmlåº”è¯¥æ€ä¹ˆå†™ã€‚

é¦–å…ˆæ˜¯ä¸€ä¸ªtableï¼Œé‡Œé¢åŒ…ç€ä¸¤ä¸ªheadeï¼ˆName & Priceï¼‰,
**Sporting Goods**å’Œ**Electronics**å‘¢ï¼Ÿ
å®ƒä»¬ä¹Ÿæ˜¯æ¯ä¸€ä¸ªç±»åˆ«çš„è¡¨å¤´ï¼Œä½†æ˜¯æ¨ªè·¨ä¸¤è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è½»æ¾å†™å‡ºè¿™æ ·çš„ç»“æ„ã€‚

```html
<table>
    <thead>
    <tr>
        <th>Name</th>
        <th>Price</th>
    </tr>
    </thead>
    <tbody>
        <tr>
            <th cols={2}>{category}</th>
        </tr>
        <tr>
            <td>{name}</td>
            <td>{price}</td>
        </tr>
    </tbody>
</table>
```
è¿™é‡Œï¼ŒNameå’ŒPriceæ˜¯å›ºå®šçš„ï¼Œè€Œåé¢çš„å†…å®¹æ˜¯æ ¹æ®åå°æ•°æ®å˜åŒ–çš„ï¼Œæ‰€ä»¥å¯ä»¥æŠŠè¿™éƒ¨åˆ†è®¾ç½®ä¸ºä¸€ä¸ªå˜é‡ï¼Œå¦‚ä¸‹ï¼š

```js
<table>
    <thead>
    <tr>
        <th>Name</th>
        <th>Price</th>
    </tr>
    </thead>
    <tbody>{rows}</tbody>
</table>
```

è¿™é‡Œæˆ‘ä»¬çš„rowsè¦æ€ä¹ˆå†™å‘¢ï¼Ÿ
è€ƒè™‘ä¸€ä¸‹ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰çš„tableå†…å®¹ï¼Œæ¯ä¸ªç±»åˆ«æœ‰ä¸€ä¸ªè¡¨å¤´å’Œå†…å®¹ï¼Œ
æ‰€ä»¥åº”è¯¥æ˜¯è¿™æ ·çš„

```js
rows=[<Category1/>,<Row1/>,<Row2/>,
<Category2/>,<Row3/>,</Row4/>]
```
è€Œæˆ‘ä»¬çš„åå°æ•°æ®æ˜¯è¿™æ ·çš„

```js
const PRODUCTS = [
    {category: 'Sporting Goods', price: '$49.99', stocked: true, name: 'Football'},
    {category: 'Sporting Goods', price: '$9.99', stocked: true, name: 'Baseball'},
    {category: 'Sporting Goods', price: '$29.99', stocked: false, name: 'Basketball'},
    {category: 'Electronics', price: '$99.99', stocked: true, name: 'iPod Touch'},
    {category: 'Electronics', price: '$399.99', stocked: false, name: 'iPhone 5'},
    {category: 'Electronics', price: '$199.99', stocked: true, name: 'Nexus 7'}
];
```

è¿™ä¹ˆå½¢æˆrowså½¢å¼çš„ç»“æ„å‘¢ï¼Ÿå°±æ˜¯å¯¹ä¸€ä¸ªæ•°ç»„åˆ¤æ–­ï¼Œå¦‚æœæœ‰ä¸€ä¸ªcategory(*æ¯”å¦‚Sporting Goods*)ï¼Œå°±pushè¿™ä¸ªè¡¨å¤´ï¼Œç„¶åpushåé¢çš„å†…å®¹.
å¦‚æœä¸‹ä¸€ä¸ªå¯¹è±¡çš„categoryè¿˜æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å°±å¿½ç•¥è¿™ä¸ªcategoryï¼Œä½†æ˜¯ç»§ç»­pushå…¶ä»–å†…å®¹ã€‚ç›´åˆ°æˆ‘ä»¬é‡åˆ°ä¸‹ä¸€ä¸ªcategory(*æ¯”å¦‚Electronics*)ï¼Œæˆ‘ä»¬æ‰pushè¿™ä¸ªè¡¨å¤´ã€‚



```js
const rows = [];
let lastCategory = null;//ä½œä¸ºæ˜¯å¦æ˜¯æ–°categoryçš„åˆ¤æ–­

//é¦–å…ˆæˆ‘ä»¬éœ€è¦ä»çˆ¶å…ƒç´ è·å–è¿™ä¸ªproductsçš„å¯¹è±¡åˆ—è¡¨ï¼Œç„¶åå¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œéå†ï¼ˆcategoryæœ‰æ–°çš„å°±pushè¡¨å¤´ï¼Œå¦åˆ™å°±pushå†…å®¹)
this.props.products.forEach((product) => {
    //è¦æ¸…æ¥šæˆ‘ä»¬éœ€è¦çš„ç»“æ„rows = [<Category1/>,<Row1/>,<Row2/>,<Category2/>,<Row3/>,</Row4/>]
    if (product.category !== lastCategory) {
        rows.push(
            <ProductCategoryRow
                category={product.category}
                key={product.category}/>
        );
        //è¿™é‡Œæ·»åŠ cataegoryæ—¶å› ä¸ºå­å…ƒç´ éœ€è¦è·å–æ¯ä¸ªè¡¨å¤´çš„åå­—ï¼Œkeyå°±ä¸å¤šè¯´äº†ï¼Œä¸æ¸…æ¥šå¯ä»¥çœ‹å®˜ç½‘äº†è§£keyçš„ä½œç”¨
    }
    rows.push(
        <ProductRow
            product={product}
            key={product.name}/>
    );
    //è¿™é‡Œæ·»åŠ productæ˜¯å› ä¸ºå­å…ƒç´ éœ€è¦è·å–æ¯ä¸ªproductçš„å†…å®¹ï¼ŒåŒ…æ‹¬ä»·æ ¼ï¼Œåç§°ç­‰ç­‰
    lastCategory = product.category;
});
```

æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª**å•é¡¹æ•°æ®æµ**çš„ç»“æ„ï¼Œè‡ªä¸Šè€Œä¸‹ï¼Œåªæœ‰ä¸€ä¸ªrender()æ–¹æ³•ï¼Œå½“æˆ‘ä»¬éœ€è¦ç¡®è®¤UIå˜åŒ–çš„åŸå› ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°è¿½æº¯åˆ°ã€‚

ç»¼ä¸Šï¼Œæˆ‘ä»¬çš„ProductTableä»£ç å¦‚ä¸‹ï¼š

```js
class ProductTable extends React.Component {
    render() {
        const rows = [];
        let lastCategory = null;
        this.props.products.forEach((product) => {
            //è¦æ¸…æ¥šæˆ‘ä»¬éœ€è¦çš„ç»“æ„rows = [<Category1/>,<Row1/>,<Row2/>,<Category2/>,<Row3/>,</Row4/>]
            if (product.category !== lastCategory) {
                rows.push(
                    <ProductCategoryRow
                        category={product.category}
                        key={product.category}/>
                );
            }
            rows.push(
                <ProductRow
                    product={product}
                    key={product.name}/>
            );
            lastCategory = product.category;
        });
        return (
            <table>
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                </tr>
                </thead>
                <tbody>{rows}</tbody>
            </table>
        );
    }
}
```

### ProductCategoryRowçš„ä¿®æ”¹

è¿™é‡Œçš„htmlç»“æ„æˆ‘ä»¬ä¸Šé¢å·²ç»è®¨è®ºè¿‡äº†ã€‚
ç”±äºéœ€è¦categoryçš„å­—æ®µï¼Œæˆ‘ä»¬ç›´æ¥ä»çˆ¶å…ƒç´ è·å–(this.props.category)

```js
class ProductCategoryRow extends Component {
    render() {
        var category = this.props.category;
        return (
        <tr>
            <th cols={2}>{category}</th>
        </tr>
        )
    }
}
```

### ProductRowçš„ä¿®æ”¹

ç»“æ„ä¹‹å‰å·²ç»è®¨è®ºè¿‡ï¼Œè€Œæˆ‘ä»¬éœ€è¦å¯¹æ˜¯å¦stockedè¿›è¡Œæ ‡è®°ï¼Œæ‰€ä»¥é‡‡å–
ä¸‰å…ƒè¡¨ç¤ºç¬¦ã€‚(stockedä¸ºfalseçš„é¢œè‰²ä¸ºçº¢)

```js
 const name = product.stocked ?
            product.name :
            <span style={{color: 'red'}}>
                {product.name}
            </span>;
```

```js
class ProductRow extends React.Component {
    render() {
        const product = this.props.product;
        const name = product.stocked ?
            product.name :
            <span style={{color: 'red'}}>
                {product.name}
            </span>;
        // å¦‚æœæ˜¯stockedå°±ç›´æ¥è¾“å‡ºï¼Œå¦åˆ™ç”¨spanåŒ…è£¹å¹¶è®¾ç½®styleçš„colorä¸ºred
        return (
            <tr>
                <td>{name}</td>
                <td>{product.price}</td>
            </tr>
        );
    }
}
```

### å®Œæ•´çš„ä»£ç 

```js
/**
 * Created by zhengzehao on 2017/10/18.
 */
import React, {Component} from 'react'
class FilterableProductTable extends Component {
    render() {
        return (<div>
            <SearchBar/>
            <ProductTable products={PRODUCTS}/>
        </div>)
    }
}

class SearchBar extends Component {
    render() {
        return (
            <div>
                <input type="text" placeholder="Search"/>
                <p>
                    <input type="checkbox"/>{''}Only show products in stock
                </p>
            </div>
        )
    }
}

class ProductTable extends React.Component {
    render() {
        const rows = [];
        let lastCategory = null;
        this.props.products.forEach((product) => {
            //è¦æ¸…æ¥šæˆ‘ä»¬éœ€è¦çš„ç»“æ„rows = [<Category1/>,<Row1/>,<Row2/>,<Category2/>,<Row3/>,</Row4/>]
            if (product.category !== lastCategory) {
                rows.push(
                    <ProductCategoryRow
                        category={product.category}
                        key={product.category}/>
                );
            }
            rows.push(
                <ProductRow
                    product={product}
                    key={product.name}/>
            );
            lastCategory = product.category;
        });
        return (
            <table>
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                </tr>
                </thead>
                <tbody>{rows}</tbody>
            </table>
        );
    }
}

class ProductCategoryRow extends Component {

    render() {
        var category = this.props.category;
        return (<tr>
            <th cols={2}>{category}</th>
        </tr>)
    }
}

class ProductRow extends React.Component {
    render() {
        const product = this.props.product;
        const name = product.stocked ?
            product.name :
            <span style={{color: 'red'}}>
                {product.name}
            </span>;
        // å¦‚æœæ˜¯stockedå°±ç›´æ¥è¾“å‡ºï¼Œå¦åˆ™ç”¨spanåŒ…è£¹å¹¶è®¾ç½®styleçš„colorä¸ºred
        return (
            <tr>
                <td>{name}</td>
                <td>{product.price}</td>
            </tr>
        );
    }
}

const PRODUCTS = [
    {category: 'Sporting Goods', price: '$49.99', stocked: true, name: 'Football'},
    {category: 'Sporting Goods', price: '$9.99', stocked: true, name: 'Baseball'},
    {category: 'Sporting Goods', price: '$29.99', stocked: false, name: 'Basketball'},
    {category: 'Electronics', price: '$99.99', stocked: true, name: 'iPod Touch'},
    {category: 'Electronics', price: '$399.99', stocked: false, name: 'iPhone 5'},
    {category: 'Electronics', price: '$199.99', stocked: true, name: 'Nexus 7'}
];
export default FilterableProductTable
```

é¢„è§ˆä¸€ä¸‹ï¼š

![](http://oxpvb4fav.bkt.clouddn.com/15083162343844.jpg)

## Step 3: Identify The Minimal (but complete) Representation Of UI State

>è¦ä½¿UIäº§ç”Ÿäº¤äº’æ•ˆæœï¼Œåœ¨REACTä¸­æˆ‘ä»¬æ˜¯é€šè¿‡stateæ¥è¿›è¡Œçš„ã€‚
### è€ƒè™‘ä¸€ä¸‹æˆ‘ä»¬çš„çš„å„ç§æ•°æ®æœ‰ï¼š

 - åç«¯æä¾›çš„productsåˆ—è¡¨ã€‚
 - inputæ ‡ç­¾çš„è¾“å…¥æ¡†äº§ç”Ÿçš„å†…å®¹
 - checkboxçš„ç»“æœ
 - ProductTableè¿‡æ»¤åçš„ç»“æœ

![](http://oxpvb4fav.bkt.clouddn.com/15083277949782.jpg)

### è€ƒè™‘æ˜¯ä¸æ˜¯stateæ•°æ®æœ‰ä»¥ä¸‹åŸåˆ™
 
- æ˜¯å¦å¯ä»¥ä»çˆ¶ç»„ä»¶é€šè¿‡propsä¼ é€’è¿‡æ¥ï¼Ÿ 
  - If so, it probably isnâ€™t state.
- æ˜¯å¦æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Ÿ
  - If so, it probably isnâ€™t state.
- æ˜¯å¦å¯ä»¥æ ¹æ®å…¶ä»–stateæˆ–è€…propsè®¡ç®—å‡ºæ¥ï¼Ÿ  
  - If so, it isnâ€™t state.

### æ¥ä¸‹æ¥é€é¡¹åˆ†æï¼š

 - productsåˆ—è¡¨çš„å†…å®¹å¯ä»¥ä»çˆ¶å…ƒç´ çš„propsè·å–ï¼Œæ‰€ä»¥ä¸æ˜¯stateã€‚
 - æœç´¢æ¡†å’Œcheckboxçš„å†…å®¹ä¼¼ä¹æ˜¯stateï¼Œå› ä¸ºå®ƒä»¬æ— æ³•ä»å…¶ä»–å…ƒç´ è·å–æˆ–è€…è®¡ç®—å¾—å‡ºã€‚
 - æœ€åï¼Œè¿‡æ»¤çš„åˆ—è¡¨ä¹Ÿä¸æ˜¯stateï¼Œå› ä¸ºå®ƒå¯ä»¥é€šè¿‡æœç´¢æ¡†å’Œcheckboxçš„å€¼è¿›è¡Œç­›é€‰å¾—å‡ºã€‚

### æœ€ç»ˆï¼Œæˆ‘ä»¬åªæœ‰ä¸¤ä¸ªstateéœ€è¦è®¾ç½®ã€‚
    
 1. æœç´¢æ¡†é‡Œç”¨æˆ·è¾“å…¥çš„å€¼
 2. checkboxçš„å€¼

## Step 4:Identify Where Your State Should Live

å¥½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç¡®å®šäº†æœ€å°çš„åº”ç”¨çŠ¶æ€æ˜¯ä»€ä¹ˆã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šå“ªä¸ªç»„ä»¶åº”è¯¥æ”¹å˜æˆ–æ‹¥æœ‰è¿™ç§çŠ¶æ€ã€‚

>è®°ä½ï¼šReactæ˜¯ä¸€ä¸ªå•å‘æ•°æ®æµçš„å±‚çº§ç»“æ„ï¼Œè€Œæˆ‘ä»¬æˆ–è®¸ä¸€å¼€å§‹å¹¶ä¸æ¸…æ¥šéœ€è¦æŠŠstateè®¾ç½®åœ¨å“ªé‡Œã€‚
è¿™é€šå¸¸æ˜¯å¯¹å…¥é—¨è€…æœ€å›°æ‰°çš„åœ°æ–¹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸‹é¢çš„æ­¥éª¤è¿›è¡Œåˆ†æã€‚

å¯¹æ¯ä¸ªstateè¿›è¡Œåˆ†æï¼š

 - Identify every component that renders something based on that state.
 - æ‰¾å‡ºæ¯ä¸ªéœ€è¦æ ¹æ®stateè¿›è¡Œæ¸²æŸ“çš„ç»„ä»¶
 - Find a common owner component (a single component above all the components that need the state in the hierarchy).
 - æ‰¾å‡ºä¸€ä¸ªå…±é€šç»„ä»¶ï¼ˆä¸€èˆ¬æ˜¯å±‚çº§ç»„ä»¶çš„ä¸Šå±‚ï¼‰
 - Either the common owner or another component higher up in the hierarchy should own the state.
 - ä¸€ä¸ªå…±é€šç»„ä»¶æˆ–è€…å¦å¤–çš„æ›´é«˜é˜¶å±‚çš„ç»„ä»¶åº”è¯¥æ‹¥æœ‰è¿™äº›state
 - If you canâ€™t find a component where it makes sense to own the state, create a new component simply for holding the state and add it somewhere in the hierarchy above the common owner component.
 - å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªç»„ä»¶é€‚åˆå»å­˜æ”¾è¿™äº›stateï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªã€‚
 
 æˆ‘ä»¬æ ¹æ®ä¸Šé¢çš„åŸåˆ™è¿›è¡Œåˆ†æ
 
 - ProductTableéœ€è¦æ ¹æ®ä¸ç”¨æˆ·åœ¨æœç´¢æ¡†çš„è¾“å…¥å’Œcheckboxçš„å‹¾é€‰è¿›è¡Œè¿‡æ»¤æ•°æ®ï¼ŒæŠŠè¿‡æ»¤åçš„æ•°æ®å±•ç¤ºåœ¨ä¸Šé¢ã€‚ 
 
 - å…±é€šçš„ç»„ä»¶ä¾¿æ˜¯FilterableProductTable.ï¼ˆProductTableå’ŒSearchBarçš„å…±é€šçˆ¶çº§ï¼‰

Cool, so weâ€™ve decided that our state lives in **FilterableProductTable**

â‘  åœ¨**FilterableProductTable** å»ºç«‹åˆå§‹state```this.state = {filterText: '', inStockOnly: false} ```
â‘¡ åœ¨\<ProductTable/> å’Œ \<SearchBar/>ä¼ é€’props filterText å’Œ inStockOnly=stateå¯¹åº”çš„å€¼ï¼Œä½¿å­ç»„ä»¶è·å–åˆ°è¯¥å€¼ã€‚


```js
<div>
<SearchBar filterText={this.state.filterText}inStockOnly={this.state.inStockOnly}/>

<ProductTable products={PRODUCTS}
filterText={this.state.filterText} inStockOnly={this.state.inStockOnly}/>
</div>
```

â‘¢ ç”¨è¿™äº›propså»è¿‡æ»¤ProductTableçš„å†…å®¹ï¼Œå¹¶ä¸”æŠŠSeachBarå¯¹åº”çš„propsè®¾ä¸ºè¿™äº›stateã€‚

```js
class SearchBar extends Component {
    render() {
        const filterText = this.props.filterText;
        const inStockOnly = this.props.inStockOnly;
        return (
            <div>
                <input type="text" placeholder="Search" value={filterText}/>
                <p>
                    <input type="checkbox" checked={inStockOnly}/>{''}Only show products in stock
                </p>
            </div>
        )
    }
}
```

```js
class ProductTable extends React.Component {
    render() {
        const filterText = this.props.filterText;
        const inStockOnly = this.props.inStockOnly;

        const rows = [];
        let lastCategory = null;
        this.props.products.forEach((product) => {

            // new
            if (product.name.indexOf(filterText) === -1) {
                return;
            }
            if (inStockOnly && !product.stocked) {
                return;
            }

            if (product.category !== lastCategory) {
                rows.push(
                    <ProductCategoryRow
                        category={product.category}
                        key={product.category}/>
                );
            }
            rows.push(
                <ProductRow
                    product={product}
                    key={product.name}/>
            );
            lastCategory = product.category;
        });
        return (
            <table>
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                </tr>
                </thead>
                <tbody>{rows}</tbody>
            </table>
        );
    }
}
```

### å®Œæ•´çš„ä»£ç 

```js
/**
 * Created by zhengzehao on 2017/10/18.
 */
import React, {Component} from 'react'
class FilterableProductTable extends Component {
    constructor(props) {
        super(props)
        this.state = {
            filterText: '',
            inStockOnly: false
        };
    }
    render() {
        return (<div>
            <SearchBar filterText={this.state.filterText} inStockOnly={this.state.inStockOnly}/>
            <ProductTable products={PRODUCTS}
                          filterText={this.state.filterText}
                          inStockOnly={this.state.inStockOnly}/>
        </div>)
    }
}

class SearchBar extends Component {
    render() {
        const filterText = this.props.filterText;
        const inStockOnly = this.props.inStockOnly;
        return (
            <div>
                <input type="text" placeholder="Search" value={filterText}/>
                <p>
                    <input type="checkbox" checked={inStockOnly}/>{''}Only show products in stock
                </p>
            </div>
        )
    }
}


class ProductTable extends React.Component {
    render() {
        const filterText = this.props.filterText;
        const inStockOnly = this.props.inStockOnly;

        const rows = [];
        let lastCategory = null;
        this.props.products.forEach((product) => {

            // new
            if (product.name.indexOf(filterText) === -1) {
                return;
            }
            if (inStockOnly && !product.stocked) {
                return;
            }

            if (product.category !== lastCategory) {
                rows.push(
                    <ProductCategoryRow
                        category={product.category}
                        key={product.category}/>
                );
            }
            rows.push(
                <ProductRow
                    product={product}
                    key={product.name}/>
            );
            lastCategory = product.category;
        });
        return (
            <table>
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                </tr>
                </thead>
                <tbody>{rows}</tbody>
            </table>
        );
    }
}


class ProductCategoryRow extends Component {
    render() {
        var category = this.props.category;
        return (<tr>
            <th cols={2}>{category}</th>
        </tr>)
    }
}

class ProductRow extends React.Component {
    render() {
        const product = this.props.product;
        const name = product.stocked ?
            product.name :
            <span style={{color: 'red'}}>
                {product.name}
            </span>;
        // å¦‚æœæ˜¯stockedå°±ç›´æ¥è¾“å‡ºï¼Œå¦åˆ™ç”¨spanåŒ…è£¹å¹¶è®¾ç½®styleçš„colorä¸ºred
        return (
            <tr>
                <td>{name}</td>
                <td>{product.price}</td>
            </tr>
        );
    }
}

const PRODUCTS = [
    {category: 'Sporting Goods', price: '$49.99', stocked: true, name: 'Football'},
    {category: 'Sporting Goods', price: '$9.99', stocked: true, name: 'Baseball'},
    {category: 'Sporting Goods', price: '$29.99', stocked: false, name: 'Basketball'},
    {category: 'Electronics', price: '$99.99', stocked: true, name: 'iPod Touch'},
    {category: 'Electronics', price: '$399.99', stocked: false, name: 'iPhone 5'},
    {category: 'Electronics', price: '$199.99', stocked: true, name: 'Nexus 7'}
];
export default FilterableProductTable
```

## Step 5: Add Inverse Data Flow

>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æ„å»ºäº†ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¯ä»¥åœ¨å±‚æ¬¡ç»“æ„ä¸­ç”¨functionçš„propsæˆ–è€…stateè¿›è¡Œæ­£ç¡®åœ°æ¸²æŸ“ã€‚ ç°åœ¨æ˜¯æ—¶å€™æ¥è¿›è¡Œæ•°æ®äº¤äº’äº†ã€‚

Reactè¿™æ ·çš„æ•°æ®ç»“æ„ä½¿æˆ‘ä»¬èƒ½æ˜ç¡®åœ°çŸ¥é“å„ä¸ªç»„ä»¶ä¹‹é—´çš„æ•°æ®æµåŠ¨ï¼Œä½†ç›¸å¯¹ä¸€èˆ¬çš„åŒå‘æ•°æ®æµï¼Œæˆ‘ä»¬éœ€è¦å¤šä¸€æ­¥ï¼ˆé€šè¿‡å›è°ƒå‡½æ•°ï¼‰æ¥æ”¹å˜stateçš„å€¼ã€‚

å¦‚æœä½ å°è¯•åœ¨ä¸Šä¸€æ­¥å»ºç«‹çš„appä¸­è¿›è¡Œè¾“å…¥æˆ–è€…æ”¹å˜checkboxçš„çŠ¶æ€ï¼Œä½ ä¼šå‘ç°æ˜¯æ— æ•ˆçš„ã€‚åŸå› æ˜¯æˆ‘ä»¬è®¾ç½®äº†inputçš„å€¼æ°¸è¿œæ˜¯ç”±FilterableProductTableçš„stateè¿›è¡Œä¼ é€’çš„ã€‚

è®©æˆ‘ä»¬ç¡®è®¤ä¸€ä¸‹å‘ç”Ÿäº†ä»€ä¹ˆã€‚æˆ‘ä»¬æƒ³è¦ç¡®å®šæ— è®ºä½•æ—¶ï¼Œç”¨æˆ·æ”¹å˜è¡¨å•ï¼Œæˆ‘ä»¬å°±æ ¹æ®è¾“å…¥çš„å†…å®¹ï¼ˆåŒ…æ‹¬inputå’Œcheckboxï¼‰æ”¹å˜æˆ‘ä»¬çš„stateã€‚
FilterableProductTable ä¼šä¼ é€’å›è°ƒå‡½æ•°ï¼Œåªè¦æˆ‘ä»¬çš„stateéœ€è¦å˜æ›´ï¼Œå®ƒä¾¿ä¼šè§¦å‘ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡onChangeä½œä¸ºè¿™ä¸ªå›è°ƒå‡½æ•°ï¼Œä¸€æ—¦ç”¨æˆ·çš„è¡¨å•å‘ç”Ÿæ”¹å˜ï¼Œæˆ‘ä»¬å°±ç”¨setState()æ¥æ”¹å˜stateã€‚

### å®Œæ•´ä»£ç 

> ç›¸å¯¹ä¸Šä¸€æ­¥ï¼Œæˆ‘ä»¬å°±å¤šäº†ä¸¤ä¸ªå‡½æ•°ï¼ŒonChangeçš„æ—¶å€™è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°è¿›è¡Œæ”¹å˜stateï¼Œæ³¨æ„è¦ç»‘å®šthiså“¦ğŸ˜¯...

```js
/**
 * Created by zhengzehao on 2017/10/18.
 */
import React, {Component} from 'react'
class FilterableProductTable extends Component {
    constructor(props) {
        super(props)
        this.state = {
            filterText: '',
            inStockOnly: false
        };
        this.handleFilterTextChange = this.handleFilterTextChange.bind(this);
        this.handleInStockChange = this.handleInStockChange.bind(this);
    }
    handleFilterTextChange(filterText){
        this.setState({
            filterText: filterText
        });
    }

    handleInStockChange(inStockOnly){
        this.setState({
            inStockOnly: inStockOnly
        })
    }
    render() {
        return (<div>
            <SearchBar filterText={this.state.filterText} inStockOnly={this.state.inStockOnly}
                       onFilterTextChange={this.handleFilterTextChange}
                       onInStockChange={this.handleInStockChange}/>
            <ProductTable products={PRODUCTS}
                          filterText={this.state.filterText}
                          inStockOnly={this.state.inStockOnly}/>
        </div>)
    }
}

class SearchBar extends Component {
    constructor(props) {
        super(props);
        this.handleFilterTextChange = this.handleFilterTextChange.bind(this);
        this.handleInStockChange = this.handleInStockChange.bind(this);
    }

    handleFilterTextChange(e) {
        this.props.onFilterTextChange(e.target.value);
    }

    handleInStockChange(e) {
        this.props.onInStockChange(e.target.checked);
    }

    render() {
        const filterText = this.props.filterText;
        const inStockOnly = this.props.inStockOnly;
        return (
            <div>
                <input type="text" placeholder="Search" value={filterText}  onChange={this.handleFilterTextChange}/>
                <p>
                    <input type="checkbox" checked={inStockOnly} onChange={this.handleInStockChange}/>{''}Only show products in stock
                </p>
            </div>
        )
    }
}


class ProductTable extends React.Component {
    render() {
        const filterText = this.props.filterText;
        const inStockOnly = this.props.inStockOnly;

        const rows = [];
        let lastCategory = null;
        this.props.products.forEach((product) => {

            // new
            if (product.name.indexOf(filterText) === -1) {
                return;
            }
            if (inStockOnly && !product.stocked) {
                return;
            }

            if (product.category !== lastCategory) {
                rows.push(
                    <ProductCategoryRow
                        category={product.category}
                        key={product.category}/>
                );
            }
            rows.push(
                <ProductRow
                    product={product}
                    key={product.name}/>
            );
            lastCategory = product.category;
        });
        return (
            <table>
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                </tr>
                </thead>
                <tbody>{rows}</tbody>
            </table>
        );
    }
}


class ProductCategoryRow extends Component {
    render() {
        var category = this.props.category;
        return (
        <tr>
            <th cols={2}>{category}</th>
        </tr>)
    }
}

class ProductRow extends React.Component {
    render() {
        const product = this.props.product;
        const name = product.stocked ?
            product.name :
            <span style={{color: 'red'}}>
                {product.name}
            </span>;
        // å¦‚æœæ˜¯stockedå°±ç›´æ¥è¾“å‡ºï¼Œå¦åˆ™ç”¨spanåŒ…è£¹å¹¶è®¾ç½®styleçš„colorä¸ºred
        return (
            <tr>
                <td>{name}</td>
                <td>{product.price}</td>
            </tr>
        );
    }
}

const PRODUCTS = [
    {category: 'Sporting Goods', price: '$49.99', stocked: true, name: 'Football'},
    {category: 'Sporting Goods', price: '$9.99', stocked: true, name: 'Baseball'},
    {category: 'Sporting Goods', price: '$29.99', stocked: false, name: 'Basketball'},
    {category: 'Electronics', price: '$99.99', stocked: true, name: 'iPod Touch'},
    {category: 'Electronics', price: '$399.99', stocked: false, name: 'iPhone 5'},
    {category: 'Electronics', price: '$199.99', stocked: true, name: 'Nexus 7'}
];
export default FilterableProductTable
```

æ­¤æ—¶å°±å¯ä»¥è¿›è¡Œç­›é€‰å’Œæœç´¢äº†ã€‚
![](http://oxpvb4fav.bkt.clouddn.com/15083295501870.jpg)
![](http://oxpvb4fav.bkt.clouddn.com/15083295612539.jpg)


ä»¥ä¸Šï¼Œè½¬è½½è¯·è¯´æ˜æ¥æºï¼ŒèŸ¹èŸ¹......









